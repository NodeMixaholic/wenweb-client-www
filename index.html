<!DOCTYPE html>
<html>
    <head><title>WenWeb WWW Client</title></head>
    <script>
        let coredb;
        let pages;
        let pageSource;
        let basePath;
        let gun = Gun()
        function parseMD(markdown) {
	        const htmlText = markdown
		        .replace(/^###### (.*$)/gim, '<h6>$1</h6>')
		        .replace(/^##### (.*$)/gim, '<h5>$1</h5>')
		        .replace(/^#### (.*$)/gim, '<h4>$1</h4>')
		        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
		        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
		        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
		        .replace(/^\> (.*$)/gim, '<blockquote>$1</blockquote>')
		        .replace(/\*\*(.*)\*\*/gim, '<b>$1</b>')
		        .replace(/\*(.*)\*/gim, '<i>$1</i>')
		        .replace(/!\[(.*?)\]\((.*?)\)/gim, "<img alt='$1' src='$2' />")
		        .replace(/\[(.*?)\]\((.*?)\)/gim, `<a href='#' onclick='hyperlink(${basePath}, $2)'>$1</a>`)
		        .replace(/\n$/gim, '<br />')

	        return htmlText.trim()
        }
        function go(){
            let path = document.getElementById("txtPath").value;
            basePath = ["",path.split("@")[1],path.split("@")[2]].join("@")
            coredb = gun.get(`~@${basePath}`).get('wenweb')
            pages = coredb.get('@pages')
            pageSource = pages.get(path.split("@")[3])
            document.getElementById("content").innerHTML = parseMD(pageSource)
        }
        function hyperlink(basePath, link) {
            if ((link.match(new RegExp(/@/g) || []).length) > 1) {
                let newBP = ["",link.split("@")[1],link.split("@")[2]].join("@")
                coredb = gun.get(`~@${newBP}`).get('wenweb')
                pages = coredb.get('@pages')
                pageSource = pages.get(link.split("@")[3])
            } else {
                pageSource = pages.get(link)
                document.getElementById("content").innerHTML = parseMD(pageSource)
            }
        }
    </script>
    <body>
        <form method="post" target="#">
            <input id="txtPath" style="width:82%;" placeholder="Put the path here" name="url" type="text" />
            <input style="width:8%;" type="button" value="Go" onclick="go(); return false;"/>
        </form>
        <div id="content">
        
        </div>
    </body>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
</html>